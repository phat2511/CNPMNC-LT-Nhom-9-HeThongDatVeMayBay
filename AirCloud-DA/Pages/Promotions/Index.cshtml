@page
@model AirCloud_DA.Pages.Promotions.IndexModel
@{
    ViewData["Title"] = "Ưu đãi";
}

<div class="container-xxl --section">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0 --heading"><i class="bi bi-gift me-2"></i>Ưu đãi đang diễn ra</h2>
    </div>

    @if (!Model.Items.Any())
    {
        <div class="empty-state">
            <i class="bi bi-gift"></i>
            <p class="text-muted mb-0">Hiện chưa có ưu đãi nào.</p>
        </div>
    }
    else
    {
        <div class="row g-4">
            @foreach (var promo in Model.Items)
            {
                var hasPercent = promo.DiscountPercent.HasValue && promo.DiscountPercent.Value > 0;
                var hasAmount = promo.DiscountAmount.HasValue && promo.DiscountAmount.Value > 0;
                var subtitle = hasPercent ? ($"Giảm {promo.DiscountPercent:0.#}%") : (hasAmount ? ($"Giảm {promo.DiscountAmount:0,0} ₫") : "Ưu đãi");
                <div class="col-12 col-md-6 col-lg-4">
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column">
                            <div class="d-flex align-items-start justify-content-between mb-2">
                                <div>
                                    <h5 class="card-title mb-1">@subtitle</h5>
                                    <div class="text-muted small">
                                        @if (promo.StartDate.HasValue || promo.EndDate.HasValue)
                                        {
                                            <span>
                                                @((promo.StartDate?.ToString("dd/MM/yyyy")) ?? "Từ nay")
                                                -
                                                @((promo.EndDate?.ToString("dd/MM/yyyy")) ?? "Không thời hạn")
                                            </span>
                                        }
                                    </div>
                                </div>
                                @if (!string.IsNullOrWhiteSpace(promo.Code))
                                {
                                    <span class="badge bg-primary">@promo.Code</span>
                                }
                            </div>

                            @if (!string.IsNullOrWhiteSpace(promo.Description))
                            {
                                <p class="card-text text-muted mb-3">@promo.Description</p>
                            }

                            <div class="mt-auto d-flex gap-2">
                                @if (!string.IsNullOrWhiteSpace(promo.Code))
                                {
                                    <button type="button" class="btn btn-primary flex-grow-1" data-code="@promo.Code" onclick="copyCode(this)">
                                        <i class="bi bi-clipboard-check me-1"></i>Sao chép mã
                                    </button>
                                }
                                <a class="btn btn-outline-primary" asp-page="/Index">
                                    <i class="bi bi-search me-1"></i>Dùng ngay
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

@section Scripts {
    <script>
        function copyCode(btn) {
            const code = btn.getAttribute('data-code');
            if (!code) return;
            navigator.clipboard.writeText(code).then(() => {
                const original = btn.innerHTML;
                btn.innerHTML = '<i class="bi bi-check2-circle me-1"></i>Đã sao chép';
                btn.classList.add('btn-success');
                setTimeout(() => { btn.innerHTML = original; btn.classList.remove('btn-success'); }, 1500);
            });
        }
    </script>
}
